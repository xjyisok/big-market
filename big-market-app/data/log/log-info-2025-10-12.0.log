25-09-30.22:23:38.327 [main            ] INFO  RaffleStrategyControllerTest - Starting RaffleStrategyControllerTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 22344 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-09-30.22:23:38.328 [main            ] INFO  RaffleStrategyControllerTest - The following 1 profile is active: "dev"
25-09-30.22:23:39.337 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-09-30.22:23:39.342 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-09-30.22:23:39.388 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 26 ms. Found 0 Redis repository interfaces.
25-09-30.22:23:40.535 [main            ] INFO  Version                - Redisson 3.23.4
25-09-30.22:23:40.790 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-09-30.22:23:40.804 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-09-30.22:23:43.711 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-09-30.22:23:43.803 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-09-30.22:23:43.896 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#3120495d:0/SimpleConnection@4ec27c4c [delegate=amqp://admin@127.0.0.1:5672/, localPort= 50547]
25-09-30.22:23:44.000 [main            ] INFO  RaffleStrategyControllerTest - Started RaffleStrategyControllerTest in 6.051 seconds (JVM running for 13.59)
25-09-30.22:23:44.190 [main            ] INFO  IRaffleStrategyController - 查询抽奖策略权重规则配置开始 userId:xiaofuge activityId：100301
25-09-30.22:23:44.231 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-09-30.22:23:44.682 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-09-30.22:23:44.720 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-09-30.22:23:44.744 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-09-30.22:23:45.000 [main            ] INFO  IRaffleStrategyController - 查询抽奖策略权重规则配置完成 userId:xiaofuge activityId：100301 response: {"code":"0000","data":[{"ruleWeightCount":4000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":60,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":5000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":6000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"},{"awardId":108,"awardTitle":"暴走玩偶"}],"userActivityAccountTotalUseCount":8862}],"info":"成功"}
25-09-30.22:23:45.002 [main            ] INFO  RaffleStrategyControllerTest - 请求参数：{"activityId":100301,"userId":"xiaofuge"}
25-09-30.22:23:45.004 [main            ] INFO  RaffleStrategyControllerTest - 测试结果：{"code":"0000","data":[{"ruleWeightCount":4000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":60,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":5000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"}],"userActivityAccountTotalUseCount":8862},{"ruleWeightCount":6000,"strategyAwards":[{"awardId":102,"awardTitle":"OpenAI会员卡"},{"awardId":103,"awardTitle":"支付优惠券"},{"awardId":104,"awardTitle":"小米台灯"},{"awardId":105,"awardTitle":"小米su7周体验"},{"awardId":106,"awardTitle":"轻奢办公椅"},{"awardId":107,"awardTitle":"小霸王游戏机"},{"awardId":108,"awardTitle":"暴走玩偶"}],"userActivityAccountTotalUseCount":8862}],"info":"成功"}
25-09-30.22:23:45.009 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-09-30.22:23:45.028 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-09-30.22:23:45.030 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-09-30.22:23:45.033 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-09-30.22:23:45.034 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-09-30.22:23:45.037 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-09-30.22:23:45.985 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-09-30.22:23:45.996 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-09-30.22:23:45.996 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-09-30.22:23:45.999 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-09-30.22:23:45.999 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-09-30.22:23:45.999 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:38:29.403 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 19184 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-11.20:38:29.413 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-10-11.20:38:31.643 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-11.20:38:31.645 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-11.20:38:31.684 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 23 ms. Found 0 Redis repository interfaces.
25-10-11.20:38:32.828 [main            ] INFO  Version                - Redisson 3.23.4
25-10-11.20:38:33.062 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:38:33.075 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:38:35.779 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-11.20:38:35.861 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-11.20:38:35.952 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#1a0f349:0/SimpleConnection@4148ce43 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 54538]
25-10-11.20:38:36.046 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 7.044 seconds (JVM running for 8.188)
25-10-11.20:38:36.237 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:38:36.458 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:38:36.493 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:38:36.520 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:38:37.239 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"user003_sku_20251011","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"user003"},"id":"33016917825","timestamp":1760186316490}
25-10-11.20:38:37.249 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"user003_sku_20251011","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"user003"},"id":"33016917825","timestamp":1760186316490}
25-10-11.20:38:37.349 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期，状态】校验开始
25-10-11.20:38:37.349 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-库存信息【有效期，状态】校验开始sku:9011,activityId:100301
25-10-11.20:38:37.357 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期库存处理成功】sku:9011,activityId:100301
25-10-11.20:38:37.388 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"user003_integral_20251011","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"user003"},"id":"14316642635","timestamp":1760186316492}
25-10-11.20:38:37.696 [main            ] INFO  IRaffleActivityController - 日历签到返利完成userID:user003,orderIds:[335262389504, 959480617905]
25-10-11.20:38:37.700 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":true,"info":"成功"}
25-10-11.20:38:37.713 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:38:37.746 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:38:37.748 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:38:37.762 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:38:38.033 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:38:38.049 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:38:38.067 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:38:38.069 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:38:38.069 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:40:39.820 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 19400 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-11.20:40:39.821 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-10-11.20:40:40.745 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-11.20:40:40.749 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-11.20:40:40.792 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 25 ms. Found 0 Redis repository interfaces.
25-10-11.20:40:41.934 [main            ] INFO  Version                - Redisson 3.23.4
25-10-11.20:40:42.176 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:40:42.190 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:40:44.973 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-11.20:40:45.075 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-11.20:40:45.144 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#7babed9e:0/SimpleConnection@a6fc1bc [delegate=amqp://admin@127.0.0.1:5672/, localPort= 54858]
25-10-11.20:40:45.226 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"user003_integral_20251011","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"user003"},"id":"14316642635","timestamp":1760186316492}
25-10-11.20:40:45.242 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.818 seconds (JVM running for 6.633)
25-10-11.20:40:45.409 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 非sku任务暂时不处理topic:send_rebate,message:{"data":{"bizId":"user003_integral_20251011","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"user003"},"id":"14316642635","timestamp":1760186316492}
25-10-11.20:40:45.441 [main            ] INFO  IRaffleActivityController - 活动抽奖 activity id 100301 userId user003
25-10-11.20:40:45.528 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:40:45.740 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:40:46.030 [main            ] INFO  IRaffleActivityController - 开始抽奖 activity id 100301 userId user003 orderId 713179568564
25-10-11.20:40:46.033 [main            ] INFO  BlackListLogicChain    - 抽奖责任链-黑名单开始userId:user003,strategyId:100006,rulemodel:rule_blacklist
25-10-11.20:40:46.097 [main            ] ERROR IRaffleActivityController - 活动抽奖失败 userId:user003 activityId:100301
org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: Table 'big_market_01.strategy_rule' doesn't exist
### The error may exist in file [D:\javacode\WebProj\big-market\big-market\big-market-app\target\classes\mybatis\mapper\strategy_rule_mapper.xml]
### The error may involve cn.bugstack.infrastructure.persistent.dao.IStrategyRuleDao.queryStrategyRuleValue-Inline
### The error occurred while setting parameters
### SQL: select rule_value from strategy_rule         where strategy_id = ? and rule_model = ?
### Cause: java.sql.SQLSyntaxErrorException: Table 'big_market_01.strategy_rule' doesn't exist
; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: Table 'big_market_01.strategy_rule' doesn't exist
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:239)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy112.selectOne(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.selectOne(SqlSessionTemplate.java:160)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:87)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy134.queryStrategyRuleValue(Unknown Source)
	at cn.bugstack.infrastructure.persistent.repository.StrategyRespositoryImpl.queryStrategyRuleValue(StrategyRespositoryImpl.java:163)
	at cn.bugstack.domain.strategy.service.rule.chain.Impl.BlackListLogicChain.logic(BlackListLogicChain.java:24)
	at cn.bugstack.domain.strategy.service.raffle.DefaultRaffleStrategy.raffleLogicChain(DefaultRaffleStrategy.java:59)
	at cn.bugstack.domain.strategy.service.AbstractRaffleStrategy.performRaffle(AbstractRaffleStrategy.java:45)
	at cn.bugstack.trigger.http.IRaffleActivityController.draw(IRaffleActivityController.java:96)
	at cn.bugstack.test.domain.trigger.RaffleActivityControllerTest.test_blacklist_draw(RaffleActivityControllerTest.java:53)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:231)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
Caused by: java.sql.SQLSyntaxErrorException: Table 'big_market_01.strategy_rule' doesn't exist
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:120)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:64)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:79)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy209.query(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:63)
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:325)
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:156)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:109)
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:89)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:140)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectOne(DefaultSqlSession.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 45 common frames omitted
25-10-11.20:40:46.110 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-10-11.20:40:46.122 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0001","info":"未知失败"}
25-10-11.20:40:50.008 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:40:50.028 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:40:50.031 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:40:55.006 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:41:00.016 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:41:01.084 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:41:01.086 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:41:01.087 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:41:01.331 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:41:01.331 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:41:01.540 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:41:01.543 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:41:01.543 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:41:01.544 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:45:22.958 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 11596 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-11.20:45:22.958 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-10-11.20:45:23.860 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-11.20:45:23.860 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-11.20:45:23.901 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 24 ms. Found 0 Redis repository interfaces.
25-10-11.20:45:24.978 [main            ] INFO  Version                - Redisson 3.23.4
25-10-11.20:45:25.192 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:45:25.203 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:45:27.780 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-11.20:45:27.864 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-11.20:45:27.930 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#9729a97:0/SimpleConnection@6a0e97fc [delegate=amqp://admin@127.0.0.1:5672/, localPort= 55430]
25-10-11.20:45:28.016 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 5.479 seconds (JVM running for 6.353)
25-10-11.20:45:28.191 [main            ] INFO  IRaffleActivityController - 活动抽奖 activity id 100301 userId user003
25-10-11.20:45:28.324 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:45:28.560 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:45:28.794 [main            ] INFO  AbstractRaffleActivityPartake - 存在未消费的抽奖订单userId:user003,activityId:100301 userorderentity:{"activityId":100301,"activityName":"测试活动","orderId":"713179568564","orderState":"create","orderTime":1760186445000,"strategyId":100006,"userId":"user003"}
25-10-11.20:45:28.794 [main            ] INFO  IRaffleActivityController - 开始抽奖 activity id 100301 userId user003 orderId 713179568564
25-10-11.20:45:28.817 [main            ] INFO  BlackListLogicChain    - 抽奖责任链-黑名单开始userId:user003,strategyId:100006,rulemodel:rule_blacklist
25-10-11.20:45:28.837 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:45:28.859 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:45:28.863 [main            ] INFO  BlackListLogicChain    - 抽奖责任链-黑名单接管userId:user003,strategyId:100006,rulemodel:rule_blacklist
25-10-11.20:45:28.878 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-10-11.20:45:28.935 [main            ] INFO  AwardRespositoryImpl   - 当前路由到的库：01
25-10-11.20:45:29.181 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"713179568564","userId":"user003"},"id":"82351201990","timestamp":1760186728901}
25-10-11.20:45:29.189 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"713179568564","userId":"user003"},"id":"82351201990","timestamp":1760186728901}
25-10-11.20:45:29.997 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-10-11.20:45:30.001 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-10-11.20:45:30.008 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:45:30.028 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:45:30.031 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:45:35.012 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:45:40.009 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:45:45.018 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:45:50.015 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:45:55.013 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:00.019 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:05.015 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:10.009 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:15.013 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:18.941 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:46:18.943 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:46:18.944 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:46:19.375 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:46:19.375 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:46:19.874 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:46:19.877 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:46:19.878 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:46:19.878 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:46:22.543 [main            ] INFO  RaffleActivityControllerTest - Starting RaffleActivityControllerTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 15232 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-11.20:46:22.545 [main            ] INFO  RaffleActivityControllerTest - The following 1 profile is active: "dev"
25-10-11.20:46:24.884 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-11.20:46:24.884 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-11.20:46:24.931 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 26 ms. Found 0 Redis repository interfaces.
25-10-11.20:46:26.047 [main            ] INFO  Version                - Redisson 3.23.4
25-10-11.20:46:26.285 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:46:26.300 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-11.20:46:29.208 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-11.20:46:29.295 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-11.20:46:29.360 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#22b7ef2b:0/SimpleConnection@7e9a836 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 55659]
25-10-11.20:46:29.449 [main            ] INFO  RaffleActivityControllerTest - Started RaffleActivityControllerTest in 7.379 seconds (JVM running for 8.346)
25-10-11.20:46:29.641 [main            ] INFO  IRaffleActivityController - 活动抽奖 activity id 100301 userId user003
25-10-11.20:46:29.733 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:46:29.967 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:46:30.011 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-11.20:46:30.025 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:30.038 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-11.20:46:30.191 [main            ] INFO  IRaffleActivityController - 开始抽奖 activity id 100301 userId user003 orderId 878418293479
25-10-11.20:46:30.196 [main            ] INFO  BlackListLogicChain    - 抽奖责任链-黑名单开始userId:user003,strategyId:100006,rulemodel:rule_blacklist
25-10-11.20:46:30.220 [main            ] INFO  BlackListLogicChain    - 抽奖责任链-黑名单接管userId:user003,strategyId:100006,rulemodel:rule_blacklist
25-10-11.20:46:30.221 [main            ] INFO  AbstractRaffleStrategy - 抽奖策略计算-责任链 user003 100006 101 rule_blacklist
25-10-11.20:46:30.407 [main            ] INFO  AwardRespositoryImpl   - 当前路由到的库：01
25-10-11.20:46:30.643 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_award message:{"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"878418293479","userId":"user003"},"id":"42387000596","timestamp":1760186790230}
25-10-11.20:46:30.651 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-1] INFO  SendAwardCustomer      - 监听用户奖品发送消息 topic: send_award message: {"data":{"awardConfig":"0.01,1","awardId":101,"awardTitle":"随机积分","orderId":"878418293479","userId":"user003"},"id":"42387000596","timestamp":1760186790230}
25-10-11.20:46:30.830 [main            ] INFO  RaffleActivityControllerTest - 请求参数：{"activityId":100301,"userId":"user003"}
25-10-11.20:46:30.832 [main            ] INFO  RaffleActivityControllerTest - 测试结果：{"code":"0000","data":{"awardId":101,"awardIndex":1,"awardTitle":"随机积分"},"info":"成功"}
25-10-11.20:46:35.021 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:40.017 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:45.015 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:50.015 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:46:55.014 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:47:00.020 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:47:05.007 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:47:10.003 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:47:14.352 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:47:14.353 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:47:14.354 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-11.20:47:14.696 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:47:14.741 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:47:15.010 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-11.20:47:15.177 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-11.20:47:15.180 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:47:15.180 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-11.20:47:15.180 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.16:49:53.442 [main            ] INFO  CreditAdjustServiceTest - Starting CreditAdjustServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 8860 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.16:49:53.443 [main            ] INFO  CreditAdjustServiceTest - The following 1 profile is active: "dev"
25-10-12.16:49:55.030 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.16:49:55.034 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.16:49:55.086 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
25-10-12.16:49:56.414 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.16:49:56.660 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.16:49:56.677 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.16:49:59.446 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.16:49:59.517 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.16:49:59.602 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#5e98032e:0/SimpleConnection@1dc9f5ad [delegate=amqp://admin@127.0.0.1:5672/, localPort= 62138]
25-10-12.16:49:59.695 [main            ] INFO  CreditAdjustServiceTest - Started CreditAdjustServiceTest in 6.684 seconds (JVM running for 7.542)
25-10-12.16:49:59.871 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始userId:xiaofuge,tradeName:REBATE,amount:10
25-10-12.16:49:59.904 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.16:50:00.045 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-12.16:50:00.066 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.16:50:00.168 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.16:50:00.168 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.16:50:00.252 [main            ] ERROR CreditRepositoryImpl   - 调整账户积分额度失败 userId:xiaofuge orderId:369724587175
org.springframework.dao.DataIntegrityViolationException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'total_amount' cannot be null
### The error may exist in file [D:\javacode\WebProj\big-market\big-market\big-market-app\target\classes\mybatis\mapper\user_credit_account_mapper.xml]
### The error may involve cn.bugstack.infrastructure.persistent.dao.IUserCreditAccountDao.updateAddAmount-Inline
### The error occurred while setting parameters
### SQL: update user_credit_account set                total_amount = total_amount + ?,                available_amount = available_amount + ?         where user_id = ?
### Cause: java.sql.SQLIntegrityConstraintViolationException: Column 'total_amount' cannot be null
; Column 'total_amount' cannot be null; nested exception is java.sql.SQLIntegrityConstraintViolationException: Column 'total_amount' cannot be null
	at org.springframework.jdbc.support.SQLExceptionSubclassTranslator.doTranslate(SQLExceptionSubclassTranslator.java:87)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:79)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy112.update(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.update(SqlSessionTemplate.java:288)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:67)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy144.updateAddAmount(Unknown Source)
	at cn.bugstack.infrastructure.persistent.repository.CreditRepositoryImpl.lambda$saveUserCreditTradeOrder$0(CreditRepositoryImpl.java:65)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at cn.bugstack.infrastructure.persistent.repository.CreditRepositoryImpl.saveUserCreditTradeOrder(CreditRepositoryImpl.java:59)
	at cn.bugstack.infrastructure.persistent.repository.CreditRepositoryImpl$$FastClassBySpringCGLIB$$c7d83984.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at cn.bugstack.infrastructure.persistent.repository.CreditRepositoryImpl$$EnhancerBySpringCGLIB$$d8e38f1.saveUserCreditTradeOrder(<generated>)
	at cn.bugstack.domain.credit.service.CreditAdjustService.createOrder(CreditAdjustService.java:38)
	at cn.bugstack.test.domain.credit.CreditAdjustServiceTest.test_CreateOrder_forward(CreditAdjustServiceTest.java:32)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:231)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Column 'total_amount' cannot be null
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy210.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 54 common frames omitted
25-10-12.16:50:00.278 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.16:50:00.280 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.16:50:00.282 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.16:50:00.675 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.16:50:00.675 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.16:50:00.688 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.16:50:00.692 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.16:50:00.692 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.16:50:00.692 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.16:54:38.004 [main            ] INFO  CreditAdjustServiceTest - Starting CreditAdjustServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 8480 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.16:54:38.006 [main            ] INFO  CreditAdjustServiceTest - The following 1 profile is active: "dev"
25-10-12.16:54:39.060 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.16:54:39.063 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.16:54:39.115 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 37 ms. Found 0 Redis repository interfaces.
25-10-12.16:54:40.213 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.16:54:40.426 [redisson-netty-2-5] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.16:54:40.438 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.16:54:43.062 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.16:54:43.148 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.16:54:43.218 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2774dcf4:0/SimpleConnection@401b67a9 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 62750]
25-10-12.16:54:43.299 [main            ] INFO  CreditAdjustServiceTest - Started CreditAdjustServiceTest in 5.688 seconds (JVM running for 6.511)
25-10-12.16:54:43.482 [main            ] INFO  CreditAdjustService    - 增加账户积分额度开始userId:xiaofuge,tradeName:REBATE,amount:10
25-10-12.16:54:43.514 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.16:54:43.752 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.16:54:43.968 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.16:54:43.970 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.16:54:43.971 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.16:54:44.279 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.16:54:44.292 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.16:54:44.293 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.16:54:44.295 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.16:54:44.295 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.16:54:44.295 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:06:13.092 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 22472 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.17:06:13.093 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-10-12.17:06:14.059 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.17:06:14.062 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.17:06:14.105 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 27 ms. Found 0 Redis repository interfaces.
25-10-12.17:06:15.254 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.17:06:15.474 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:06:15.487 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:06:18.131 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.17:06:18.217 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.17:06:18.277 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#43588265:0/SimpleConnection@646d58cd [delegate=amqp://admin@127.0.0.1:5672/, localPort= 64093]
25-10-12.17:06:18.354 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 5.674 seconds (JVM running for 6.584)
25-10-12.17:06:18.554 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:06:18.806 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:06:18.843 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:06:18.867 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:06:19.233 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_20251012001","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"17740642149","timestamp":1760259978841}
25-10-12.17:06:19.244 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_sku_20251012001","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"17740642149","timestamp":1760259978841}
25-10-12.17:06:19.354 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期，状态】校验开始
25-10-12.17:06:19.354 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-库存信息【有效期，状态】校验开始sku:9011,activityId:100301
25-10-12.17:06:19.360 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期库存处理成功】sku:9011,activityId:100301
25-10-12.17:06:19.361 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_20251012001","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"91936930347","timestamp":1760259978842}
25-10-12.17:06:19.586 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"20251012001","userId":"xiaofuge"}
25-10-12.17:06:19.588 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["568078543927","197908935770"]
25-10-12.17:06:19.603 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:06:19.674 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:06:19.675 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:06:19.756 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:06:20.006 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-12.17:06:20.011 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:06:20.021 [pool-4-thread-1 ] INFO  UpdateActivitySkuStockJob - 定时任务，更新活动sku库存 sku:9011 activityId:100301
25-10-12.17:06:20.031 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:06:20.343 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:06:20.343 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:06:20.346 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:06:20.347 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:06:20.347 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:07:40.566 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 7300 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.17:07:40.567 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-10-12.17:07:41.551 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.17:07:41.556 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.17:07:41.595 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 25 ms. Found 0 Redis repository interfaces.
25-10-12.17:07:42.754 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.17:07:42.969 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:07:42.981 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:07:45.556 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.17:07:45.646 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.17:07:45.715 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#505d2bac:0/SimpleConnection@24435620 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 64334]
25-10-12.17:07:45.791 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_integral_20251012001","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"91936930347","timestamp":1760259978842}
25-10-12.17:07:45.804 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 5.643 seconds (JVM running for 6.468)
25-10-12.17:07:45.969 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustService    - 增加账户积分额度开始userId:xiaofuge,tradeName:REBATE,amount:10
25-10-12.17:07:46.003 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:07:46.033 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:07:46.239 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:07:46.240 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:07:46.556 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_20251012002","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"94763257328","timestamp":1760260066266}
25-10-12.17:07:46.558 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_sku_20251012002","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"94763257328","timestamp":1760260066266}
25-10-12.17:07:46.626 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期，状态】校验开始
25-10-12.17:07:46.627 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-库存信息【有效期，状态】校验开始sku:9011,activityId:100301
25-10-12.17:07:46.633 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期库存处理成功】sku:9011,activityId:100301
25-10-12.17:07:46.699 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_20251012002","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"67975370420","timestamp":1760260066268}
25-10-12.17:07:46.818 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_integral_20251012002","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"67975370420","timestamp":1760260066268}
25-10-12.17:07:46.818 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustService    - 增加账户积分额度开始userId:xiaofuge,tradeName:REBATE,amount:10
25-10-12.17:07:46.910 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"20251012002","userId":"xiaofuge"}
25-10-12.17:07:46.912 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["188147154866","239308036952"]
25-10-12.17:07:46.926 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:07:46.928 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:07:46.930 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:07:47.680 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:07:47.786 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:07:47.801 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:07:47.804 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:07:47.804 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:07:47.804 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:08:18.125 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 2592 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.17:08:18.127 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-10-12.17:08:19.032 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.17:08:19.036 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.17:08:19.075 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 26 ms. Found 0 Redis repository interfaces.
25-10-12.17:08:20.164 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.17:08:20.382 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:08:20.394 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:08:23.006 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.17:08:23.088 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.17:08:23.157 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2774dcf4:0/SimpleConnection@401b67a9 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 64575]
25-10-12.17:08:23.251 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 5.53 seconds (JVM running for 6.366)
25-10-12.17:08:23.463 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:08:23.693 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:08:23.725 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:08:23.749 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:08:24.097 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_20251012003","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"32339524513","timestamp":1760260103723}
25-10-12.17:08:24.107 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_sku_20251012003","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"32339524513","timestamp":1760260103723}
25-10-12.17:08:24.204 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期，状态】校验开始
25-10-12.17:08:24.204 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-库存信息【有效期，状态】校验开始sku:9011,activityId:100301
25-10-12.17:08:24.210 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期库存处理成功】sku:9011,activityId:100301
25-10-12.17:08:24.247 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_20251012003","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"77038032071","timestamp":1760260103724}
25-10-12.17:08:24.404 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"20251012003","userId":"xiaofuge"}
25-10-12.17:08:24.408 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["949279694768","716987928067"]
25-10-12.17:08:24.419 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:08:24.421 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:08:24.422 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:08:24.467 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:08:25.018 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:08:25.030 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-12.17:08:25.031 [pool-4-thread-1 ] INFO  UpdateActivitySkuStockJob - 定时任务，更新活动sku库存 sku:9011 activityId:100301
25-10-12.17:08:25.037 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:08:25.227 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:08:25.242 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:08:25.244 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:08:25.245 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:08:25.245 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:09:12.145 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 15400 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.17:09:12.146 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-10-12.17:09:13.103 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.17:09:13.105 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.17:09:13.144 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 26 ms. Found 0 Redis repository interfaces.
25-10-12.17:09:14.242 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.17:09:14.453 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:09:14.464 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:09:17.014 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.17:09:17.093 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.17:09:17.164 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2774dcf4:0/SimpleConnection@401b67a9 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 64757]
25-10-12.17:09:17.253 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_integral_20251012003","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"77038032071","timestamp":1760260103724}
25-10-12.17:09:17.266 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 5.546 seconds (JVM running for 6.409)
25-10-12.17:09:17.444 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustService    - 增加账户积分额度开始userId:xiaofuge,tradeName:REBATE,amount:10
25-10-12.17:09:17.475 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:09:17.492 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:09:17.699 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:09:17.700 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:09:17.792 [main            ] ERROR RebateRespositoryImpl  - 写入返利记录，唯一索引冲突 userId: xiaofuge
org.springframework.dao.DuplicateKeyException: 
### Error updating database.  Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_20251012003' for key 'user_behavior_rebate_order_001.uq_biz_id'
### The error may exist in file [D:\javacode\WebProj\big-market\big-market\big-market-app\target\classes\mybatis\mapper\user_behavior_rebate_order_mapper.xml]
### The error may involve cn.bugstack.infrastructure.persistent.dao.IUserBehaiviorRebateOrderDao.insert-Inline
### The error occurred while setting parameters
### SQL: insert into user_behavior_rebate_order_001(         user_id, order_id, behavior_type, rebate_desc, rebate_type, rebate_config, biz_id,out_business_no, create_time, update_time         ) values(         ?, ?, ?, ?, ?, ?, ?, ?,now(), now()         )
### Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_20251012003' for key 'user_behavior_rebate_order_001.uq_biz_id'
; Duplicate entry 'xiaofuge_sku_20251012003' for key 'user_behavior_rebate_order_001.uq_biz_id'; nested exception is java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_20251012003' for key 'user_behavior_rebate_order_001.uq_biz_id'
	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:247)
	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:70)
	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:91)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:441)
	at com.sun.proxy.$Proxy112.insert(Unknown Source)
	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:272)
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:62)
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:152)
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:85)
	at com.sun.proxy.$Proxy146.insert(Unknown Source)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at com.sun.proxy.$Proxy147.insert(Unknown Source)
	at cn.bugstack.infrastructure.persistent.repository.RebateRespositoryImpl.lambda$saveUserRebateRecord$0(RebateRespositoryImpl.java:81)
	at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:140)
	at cn.bugstack.infrastructure.persistent.repository.RebateRespositoryImpl.saveUserRebateRecord(RebateRespositoryImpl.java:67)
	at cn.bugstack.infrastructure.persistent.repository.RebateRespositoryImpl$$FastClassBySpringCGLIB$$c0e40bd3.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:793)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
	at cn.bugstack.infrastructure.persistent.repository.RebateRespositoryImpl$$EnhancerBySpringCGLIB$$31d45353.saveUserRebateRecord(<generated>)
	at cn.bugstack.domain.rebate.service.BehaviorRebateService.createOrder(BehaviorRebateService.java:78)
	at cn.bugstack.test.domain.rebate.BehaviorRebateServiceTest.test_createOrder(BehaviorRebateServiceTest.java:37)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)
	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)
	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)
	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)
	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:231)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:55)
Caused by: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry 'xiaofuge_sku_20251012003' for key 'user_behavior_rebate_order_001.uq_biz_id'
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:117)
	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:97)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:953)
	at com.mysql.cj.jdbc.ClientPreparedStatement.execute(ClientPreparedStatement.java:370)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java)
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:47)
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.ibatis.plugin.Plugin.invoke(Plugin.java:63)
	at com.sun.proxy.$Proxy210.update(Unknown Source)
	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:50)
	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:117)
	at org.apache.ibatis.executor.CachingExecutor.update(CachingExecutor.java:76)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:197)
	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:427)
	... 65 common frames omitted
25-10-12.17:09:17.950 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:09:17.953 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:09:17.954 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:09:18.011 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:09:18.229 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:09:18.259 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:09:18.262 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:09:18.263 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:09:18.263 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:09:28.333 [main            ] INFO  BehaviorRebateServiceTest - Starting BehaviorRebateServiceTest using Java 1.8.0_462 on DESKTOP-8JHLMP8 with PID 16516 (started by XDUAI in D:\javacode\WebProj\big-market\big-market\big-market-app)
25-10-12.17:09:28.334 [main            ] INFO  BehaviorRebateServiceTest - The following 1 profile is active: "dev"
25-10-12.17:09:29.282 [main            ] INFO  RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
25-10-12.17:09:29.285 [main            ] INFO  RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
25-10-12.17:09:29.332 [main            ] INFO  RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 32 ms. Found 0 Redis repository interfaces.
25-10-12.17:09:30.480 [main            ] INFO  Version                - Redisson 3.23.4
25-10-12.17:09:30.695 [redisson-netty-2-4] INFO  MasterPubSubConnectionPool - 1 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:09:30.708 [redisson-netty-2-13] INFO  MasterConnectionPool   - 5 connections initialized for 127.0.0.1/127.0.0.1:6379
25-10-12.17:09:33.285 [main            ] INFO  EndpointLinksResolver  - Exposing 1 endpoint(s) beneath base path '/actuator'
25-10-12.17:09:33.381 [main            ] INFO  CachingConnectionFactory - Attempting to connect to: [127.0.0.1:5672]
25-10-12.17:09:33.461 [main            ] INFO  CachingConnectionFactory - Created new connection: rabbitConnectionFactory#2774dcf4:0/SimpleConnection@401b67a9 [delegate=amqp://admin@127.0.0.1:5672/, localPort= 64900]
25-10-12.17:09:33.553 [main            ] INFO  BehaviorRebateServiceTest - Started BehaviorRebateServiceTest in 5.65 seconds (JVM running for 6.483)
25-10-12.17:09:33.749 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:09:33.970 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:09:34.005 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:09:34.028 [main            ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:09:34.373 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_sku_20251012004","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"47203242611","timestamp":1760260174002}
25-10-12.17:09:34.382 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_sku_20251012004","rebateConfig":"9011","rebateDesc":"签到返利-sku额度","rebateType":"sku","userId":"xiaofuge"},"id":"47203242611","timestamp":1760260174002}
25-10-12.17:09:34.476 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivityBaseActionChain - 活动责任链-基础信息【有效期，状态】校验开始
25-10-12.17:09:34.476 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-库存信息【有效期，状态】校验开始sku:9011,activityId:100301
25-10-12.17:09:34.481 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  ActivitySkuStockActionChain - 活动责任链-商品库存处理【有效期库存处理成功】sku:9011,activityId:100301
25-10-12.17:09:34.584 [main            ] INFO  EventPublisher         - 发送MQ消息 topic:send_rebate message:{"data":{"bizId":"xiaofuge_integral_20251012004","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"07435901951","timestamp":1760260174003}
25-10-12.17:09:34.748 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  BehaviorRebateServiceTaskConsumer - 监听返利消息topic:send_rebate,message:{"data":{"bizId":"xiaofuge_integral_20251012004","rebateConfig":"10","rebateDesc":"签到返利-积分","rebateType":"integral","userId":"xiaofuge"},"id":"07435901951","timestamp":1760260174003}
25-10-12.17:09:34.750 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] INFO  CreditAdjustService    - 增加账户积分额度开始userId:xiaofuge,tradeName:REBATE,amount:10
25-10-12.17:09:34.828 [main            ] INFO  BehaviorRebateServiceTest - 请求参数：{"behaviorTypeVO":"SIGN","outBusinessNo":"20251012004","userId":"xiaofuge"}
25-10-12.17:09:34.831 [main            ] INFO  BehaviorRebateServiceTest - 测试结果：["530317216719","478119881443"]
25-10-12.17:09:34.844 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:09:34.846 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:09:34.848 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Waiting for workers to finish.
25-10-12.17:09:35.011 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Starting...
25-10-12.17:09:35.025 [scheduling-1    ] INFO  UpdateAwardStockJob    - 当前无事务
25-10-12.17:09:35.025 [pool-4-thread-1 ] INFO  UpdateActivitySkuStockJob - 定时任务，更新活动sku库存 sku:9011 activityId:100301
25-10-12.17:09:35.028 [pool-3-thread-2 ] INFO  HikariDataSource       - Retail_HikariCP - Start completed.
25-10-12.17:09:35.057 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:09:35.543 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:09:35.560 [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#2-2] INFO  SimpleMessageListenerContainer - Successfully waited for workers to finish.
25-10-12.17:09:35.563 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:09:35.563 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
25-10-12.17:09:35.563 [SpringApplicationShutdownHook] INFO  SimpleMessageListenerContainer - Shutdown ignored - container is already stopped
